@model IEnumerable<Puerto92.ViewModels.CategoriaViewModel>
@{
    ViewData["Title"] = "Configuración Global";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
    var tipoActual = ViewBag.TipoActual as string ?? "Bebidas";
    var tiposTodos = ViewBag.TiposTodos as string[] ?? new string[0];
    var estadisticas = ViewBag.Estadisticas as Dictionary<string, int> ?? new Dictionary<string, int>();
}

<!-- Page Header -->
<div class="page-header">
    <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
        <i class="fa-solid fa-gear" style="color: #0092B8; font-size: 24px;"></i>
        <h1 class="page-title">Configuración Global</h1>
    </div>
    <p class="page-subtitle">Gestionar categorías del sistema para productos y utensilios</p>
</div>

<!-- Stats Cards -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-icon" style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(245, 158, 11, 0.2)); color: #F59E0B; border: 2px solid rgba(245, 158, 11, 0.2);">
            <i class="fa-solid fa-wine-bottle"></i>
        </div>
        <div class="stat-content">
            <h3>@(estadisticas.ContainsKey("Bebidas") ? estadisticas["Bebidas"] : 0)</h3>
            <p>Categorías Bebidas</p>
            <small style="color: #64748B;"> 0 productos</small>
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-icon" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(59, 130, 246, 0.2)); color: #3B82F6; border: 2px solid rgba(59, 130, 246, 0.2);">
            <i class="fa-solid fa-utensils"></i>
        </div>
        <div class="stat-content">
            <h3>@(estadisticas.ContainsKey("Cocina") ? estadisticas["Cocina"] : 0)</h3>
            <p>Categorías Cocina</p>
            <small style="color: #64748B;"> 0 productos</small>
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-icon" style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(16, 185, 129, 0.2)); color: #10B981; border: 2px solid rgba(16, 185, 129, 0.2);">
            <i class="fa-solid fa-kitchen-set"></i>
        </div>
        <div class="stat-content">
            <h3>@(estadisticas.ContainsKey("Utensilios") ? estadisticas["Utensilios"] : 0)</h3>
            <p>Categorías Utensilios</p>
            <small style="color: #64748B;"> 0 productos</small>
        </div>
    </div>
</div>

<!-- Content Card -->
<div class="content-card">
    <div class="card-header" style="border-bottom: none; padding-bottom: 0;">
        <div style="display: flex; align-items: center; gap: 0.75rem;">
            <i class="fa-solid fa-list" style="color: #0092B8; font-size: 20px;"></i>
            <div>
                <h2 class="card-title">Gestionar Categorías</h2>
                <p style="font-size: 13px; color: #64748B; margin-top: 0.25rem;">
                    Organice productos y utensilios según clasificaciones operativas
                </p>
            </div>
        </div>
        <button onclick="openCreateCategoriaModal()" class="btn btn-primary">
            <i class="fa-solid fa-plus"></i>
            Agregar Nueva Categoría
        </button>
    </div>

    <div class="card-body" style="padding-top: 1rem;">
        <!-- Tabs de Tipos -->
        <div class="categoria-tabs">
            @foreach (var tipo in tiposTodos)
            {
                var activeClass = tipo == tipoActual ? "active" : "";
                var icon = tipo == "Bebidas" ? "wine-glass" : (tipo == "Cocina" ? "utensils" : "kitchen-set");
                
                <a href="@Url.Action("Index", "Categorias", new { tipo = tipo })" 
                   class="categoria-tab @activeClass"
                   data-navigate>
                    <i class="fa-solid fa-@icon"></i>
                    <span>@tipo</span>
                </a>
            }
        </div>

        @if (!Model.Any())
        {
            <div class="empty-state">
                <i class="fa-solid fa-folder-open"></i>
                <h3>No hay categorías en @tipoActual</h3>
                <p>Comience creando su primera categoría para este tipo.</p>

            </div>
        }
        else
        {
            <!-- Tabla -->
            <div class="table-responsive">
                <table class="table categoria-table" id="categoriasTable">
                    <thead>
                        <tr>
                            <th style="width: 80px;">Orden</th>
                            <th>Nombre de Categoría</th>
                            <th style="width: 180px; text-align: center;">Productos Asignados</th>
                            <th style="width: 150px; text-align: center;">Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="sortableCategoriasTable">
                        @foreach (var categoria in Model)
                        {
                            <tr data-categoria-id="@categoria.Id" data-orden="@categoria.Orden">
                                <td>
                                    <div class="orden-cell">
                                        <i class="fa-solid fa-grip-vertical drag-handle"></i>
                                        <span class="orden-number">@categoria.Orden</span>
                                    </div>
                                </td>
                                <td style="font-weight: 500; font-size: 14px;">
                                    <i class="fa-solid fa-circle" style="font-size: 8px; color: @(categoria.Activo ? "#10B981" : "#EF4444"); margin-right: 0.5rem;"></i>
                                    @categoria.Nombre
                                </td>
                                <td style="text-align: center;">
                                    @if (categoria.CantidadProductos > 0)
                                    {
                                        <span class="badge" style="background: rgba(59, 130, 246, 0.1); color: #3B82F6; font-size: 13px;">
                                            @categoria.CantidadProductos producto(s)
                                        </span>
                                    }
                                    else
                                    {
                                        <span style="color: #94A3B8; font-size: 13px;">Sin productos</span>
                                    }
                                </td>
                                <td style="text-align: center;">
                                    <div style="display: flex; gap: 0.5rem; justify-content: center;">
                                        <button onclick="openEditCategoriaModal(@categoria.Id)" 
                                                class="btn-icon btn-icon-edit" 
                                                title="Editar categoría">
                                            <i class="fa-solid fa-pen"></i>
                                        </button>

                                        <button onclick="openDeleteCategoriaModal(@categoria.Id, '@categoria.Nombre', @categoria.CantidadProductos, '@tipoActual')" 
                                                class="btn-icon btn-icon-delete" 
                                                title="Eliminar categoría">
                                            <i class="fa-solid fa-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>

            <!-- Nota sobre reordenamiento -->
            <div style="background: #EFF6FF; border-left: 3px solid #3B82F6; padding: 0.875rem; border-radius: 4px; margin-top: 1.5rem;">
                <div style="display: flex; align-items: center; gap: 0.5rem; color: #1E40AF; font-size: 13px;">
                    <i class="fa-solid fa-info-circle"></i>
                    <span><strong>Tip:</strong> Arrastra y suelta las filas usando el ícono <i class="fa-solid fa-grip-vertical" style="font-size: 11px;"></i> para cambiar el orden de visualización.</span>
                </div>
            </div>
        }
    </div>
</div>

@* Cargar Modales *@
<partial name="Modals/_CreateCategoriaModal" model="@tipoActual" />
<partial name="Modals/_EditCategoriaModal" />
<partial name="Modals/_DeleteCategoriaModal" />

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <script src="~/js/categorias-modals.js" asp-append-version="true"></script>
}