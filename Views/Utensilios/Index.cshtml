@model IEnumerable<Puerto92.ViewModels.UtensilioViewModel>
@{
    ViewData["Title"] = "Cat√°logo de Utensilios";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}

@section Styles {
    <link rel="stylesheet" href="~/css/utensilios.css" asp-append-version="true" />
}

<div class="page-header">
    <h1 class="page-title">Cat√°logo de Utensilios</h1>
    <p class="page-subtitle">Gestione el inventario base de utensilios para todos los locales</p>
</div>

<!-- Stats Cards -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-icon primary">
            <i class="fa-solid fa-utensils"></i>
        </div>
        <div class="stat-content">
            <h3>@ViewBag.TotalActivos</h3>
            <p>Total Activos</p>
            <small style="color: #64748B;">Disponibles para uso</small>
        </div>
    </div>

    @foreach (var stat in ViewBag.EstadisticasPorCategoria as Dictionary<string, int>)
    {
        <div class="stat-card">
            <div class="stat-icon success">
                <i class="fa-solid fa-utensils"></i>
            </div>
            <div class="stat-content">
                <h3>@stat.Value</h3>
                <p>@stat.Key</p>
                <small style="color: #64748B;">Activos</small>
            </div>
        </div>
    }
</div>

<!-- Content Card -->
<div class="content-card">
    <!-- Tabs de Categor√≠as -->
    <div class="categoria-tabs">
        <a href="@Url.Action("Index")" 
           class="categoria-tab @(ViewBag.CategoriaFiltro == null ? "active" : "")">
            <i class="fa-solid fa-list"></i>
            <span>Todos</span>
        </a>
        
        @foreach (var cat in ViewBag.Categorias)
        {
            <a href="@Url.Action("Index", new { categoriaId = cat.Id })" 
               class="categoria-tab @(ViewBag.CategoriaFiltro == cat.Id ? "active" : "")">
                <i class="fa-solid fa-utensils"></i>
                <span>@cat.Nombre</span>
                <span class="tab-badge">@(ViewBag.EstadisticasPorCategoria.ContainsKey(cat.Nombre) ? ViewBag.EstadisticasPorCategoria[cat.Nombre] : 0)</span>
            </a>
        }
    </div>

    <div class="card-header">
        <div>
            <h2 class="card-title">
                @if (ViewBag.CategoriaFiltro == null)
                {
                    <span>Todos los Utensilios</span>
                }
                else
                {
                    var categoriaActual = (ViewBag.Categorias as List<Puerto92.Models.Categoria>)?.FirstOrDefault(c => c.Id == ViewBag.CategoriaFiltro);
                    <span>@(categoriaActual?.Nombre ?? "Utensilios")</span>
                }
            </h2>
            <p style="font-size: 13px; color: #64748B; margin-top: 4px;">
                @Model.Count() utensilio(s) encontrado(s)
            </p>
        </div>
        <div style="display: flex; gap: 0.75rem;">
            <button onclick="openCargaMasivaModal()" class="btn btn-secondary">
                <i class="fa-solid fa-file-import"></i>
                Carga Masiva
            </button>
            <button onclick="openCreateUtensilioModal()" class="btn btn-primary">
                <i class="fa-solid fa-plus"></i>
                Agregar Utensilio
            </button>
        </div>
    </div>

    <div class="card-body">
        <!-- Buscador -->
        <div style="margin-bottom: 1.5rem;">
            <input type="text" id="searchInput" class="form-control" 
                   placeholder="üîç Buscar por c√≥digo, nombre o categor√≠a..." 
                   style="max-width: 400px;" />
        </div>

        @if (!Model.Any())
        {
            <div class="empty-state">
                <i class="fa-solid fa-box-open"></i>
                <h3>No hay utensilios registrados</h3>
                <p>
                    @if (ViewBag.CategoriaFiltro == null)
                    {
                        <span>Comienza agregando utensilios usando los botones superiores</span>
                    }
                    else
                    {
                        var categoriaActual = (ViewBag.Categorias as List<Puerto92.Models.Categoria>)?.FirstOrDefault(c => c.Id == ViewBag.CategoriaFiltro);
                        <span>No hay utensilios de categor√≠a @(categoriaActual?.Nombre) registrados</span>
                    }
                </p>
            </div>
        }
        else
        {
            <!-- Tabla -->
            <div class="table-responsive">
                <table class="table" id="utensiliosTable">
                    <thead>
                        <tr>
                            <th>C√≥digo</th>
                            <th>Nombre</th>
                            <th>Categor√≠a</th>
                            <th>Unidad</th>
                            <th>Precio (S/)</th>
                            <th>Estado</th>
                            <th style="text-align: center;">Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var utensilio in Model)
                        {
                            <tr>
                                <td style="font-weight: 600; color: #3B82F6;">@utensilio.Codigo</td>
                                <td style="font-weight: 500;">@utensilio.Nombre</td>
                                <td>
                                    @* ‚≠ê MOSTRAR NOMBRE DE CATEGOR√çA *@
                                    @if (!string.IsNullOrEmpty(utensilio.CategoriaNombre))
                                    {
                                        @if (utensilio.CategoriaNombre == "Cocina" || utensilio.CategoriaNombre.Contains("Cocina"))
                                        {
                                            <span class="badge badge-success">
                                                <i class="fa-solid fa-fire-burner"></i> @utensilio.CategoriaNombre
                                            </span>
                                        }
                                        else if (utensilio.CategoriaNombre == "Mozos" || utensilio.CategoriaNombre.Contains("Mozos"))
                                        {
                                            <span class="badge badge-warning">
                                                <i class="fa-solid fa-user-tie"></i> @utensilio.CategoriaNombre
                                            </span>
                                        }
                                        else if (utensilio.CategoriaNombre == "Vajilla" || utensilio.CategoriaNombre.Contains("Vajilla"))
                                        {
                                            <span class="badge badge-danger">
                                                <i class="fa-solid fa-plate-wheat"></i> @utensilio.CategoriaNombre
                                            </span>
                                        }
                                        else if (utensilio.CategoriaNombre == "Cubiertos" || utensilio.CategoriaNombre.Contains("Cubiertos"))
                                        {
                                            <span class="badge badge-info">
                                                <i class="fa-solid fa-utensils"></i> @utensilio.CategoriaNombre
                                            </span>
                                        }
                                        else
                                        {
                                            <span class="badge badge-primary">
                                                <i class="fa-solid fa-utensils"></i> @utensilio.CategoriaNombre
                                            </span>
                                        }
                                    }
                                    else
                                    {
                                        <span class="badge badge-secondary">Sin categor√≠a</span>
                                    }
                                </td>
                                <td>@utensilio.Unidad</td>
                                <td style="font-weight: 600; color: #10B981;">S/ @utensilio.Precio.ToString("N2")</td>
                                <td>
                                    @if (utensilio.Activo)
                                    {
                                        <span class="badge badge-success">Activo</span>
                                    }
                                    else
                                    {
                                        <span class="badge badge-danger">Inactivo</span>
                                    }
                                </td>
                                <td style="text-align: center;">
                                    <div style="display: flex; gap: 0.5rem; justify-content: center;">
                                        @if (utensilio.Activo)
                                        {
                                            <!-- Bot√≥n Editar -->
                                            <button onclick="openEditUtensilioModal(@utensilio.Id)" 
                                                    class="btn-icon btn-icon-edit" 
                                                    title="Editar">
                                                <i class="fa-regular fa-pen-to-square"></i>
                                            </button>
                                            
                                            <!-- Bot√≥n Desactivar - ‚≠ê PASAR CategoriaNombre -->
                                            <button onclick="openDesactivarUtensilioModal(@utensilio.Id, '@utensilio.Codigo', '@utensilio.Nombre', '@utensilio.CategoriaNombre')" 
                                                    class="btn-icon btn-icon-delete" 
                                                    title="Desactivar">
                                                <i class="fa-regular fa-circle-xmark"></i>
                                            </button>
                                        }
                                        else
                                        {
                                            <span style="font-size: 12px; color: #94A3B8;">Inactivo</span>
                                        }
                                    </div>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        }
    </div>
</div>

@* Cargar Modales *@
<partial name="Modals/_CreateUtensilioModal" />
<partial name="Modals/_EditUtensilioModal" />
<partial name="Modals/_DesactivarUtensilioModal" />
<partial name="Modals/_CargaMasivaUtensiliosModal" />

@section Scripts {
    <script src="~/js/utensilios-modals.js" asp-append-version="true"></script>
}